# AI 自动化运维管理系统 - 操作手册

## 目录
- [系统登录](#系统登录)
- [仪表盘](#仪表盘)
- [服务器管理](#服务器管理)
- [SSH 密钥管理](#ssh-密钥管理)
- [Kubernetes 集群管理](#kubernetes-集群管理)
- [告警中心](#告警中心)
- [系统管理](#系统管理)
- [租户管理](#租户管理)
- [其他功能模块](#其他功能模块)

---

## 系统登录

### 访问地址
- 开发环境：http://localhost:5173
- 生产环境：http://your-domain.com

### 默认账号
| 角色 | 用户名 | 密码 | 权限说明 |
|------|--------|------|----------|
| 超级管理员 | admin | admin123 | 拥有所有权限 |

> ⚠️ **安全提示**：首次登录后请立即修改密码！

### 登录步骤
1. 打开浏览器，输入系统地址
2. 输入用户名和密码
3. 点击"登录"按钮
4. 登录成功后跳转至仪表盘

---

## 仪表盘

仪表盘展示系统整体运行状态，包括：

### 模块概览
| 卡片 | 说明 |
|------|------|
| 服务器概览 | 显示服务器总数、在线/离线数量 |
| 告警概览 | 显示告警总数、待处理/已处理数量 |
| 资源使用 | CPU、内存、磁盘使用率图表 |
| 最近告警 | 最新 10 条告警信息 |
| 任务状态 | 定时任务执行状态统计 |

### 快捷操作
- 点击卡片可快速跳转至对应功能模块
- 告警列表支持一键处理

---

## 服务器管理

### 访问路径
`服务器管理` → `服务器列表`（路径：`/servers/list`）

### 功能概览

#### 1. 服务器列表
展示所有已添加的服务器，包括：
- 服务器名称、IP 地址
- 操作系统、CPU/内存/磁盘使用率
- 运行状态（在线/离线/未知）
- 所属分组

#### 2. 添加服务器

**操作步骤：**
1. 点击右上角 **"添加服务器"** 按钮
2. 填写服务器信息：

| 字段 | 必填 | 说明 |
|------|------|------|
| 名称 | ✅ | 服务器显示名称 |
| IP 地址 | ✅ | 服务器 IP 或域名 |
| SSH 端口 | ✅ | SSH 服务端口，默认 22 |
| 用户名 | ✅ | SSH 登录用户名 |
| 认证方式 | ✅ | 密码 或 SSH 密钥 |
| 密码 | 条件 | 密码认证时填写 |
| SSH 密钥 | 条件 | 密钥认证时选择已上传的密钥 |
| 分组 | ❌ | 服务器分组 |
| 标签 | ❌ | 自定义标签 |

3. 点击 **"保存"** 完成添加

#### 3. SSH 密钥认证（重要）

当选择 **"SSH 密钥"** 认证方式时：

**步骤 1：添加密钥**
1. 在添加服务器弹窗中，认证方式选择 **"SSH 密钥"**
2. 点击 **"添加密钥"** 按钮
3. 在弹窗中填写：
   - **密钥名称**：自定义名称（如：生产服务器密钥）
   - **上传文件**：点击"选择 .pem 文件"上传私钥文件
   - **或输入内容**：直接粘贴私钥内容
   - **密钥密码**：如果私钥有密码保护则填写
   - **描述**：可选的描述信息

**步骤 2：选择密钥**
- 密钥保存成功后，在 SSH 密钥下拉框中选择刚添加的密钥

**密钥文件格式示例：**
```
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA2Z3qX2BTLS4e...
-----END RSA PRIVATE KEY-----
```

> 📝 **提示**：系统支持 `.pem` 和 `.key` 格式的私钥文件

#### 4. 服务器操作

| 操作 | 说明 |
|------|------|
| 监控 | 查看服务器详细监控数据 |
| 日志 | 查看系统日志、安全日志、应用日志 |
| AI分析 | 使用 AI 分析服务器状态并提供优化建议 |
| 执行命令 | 远程执行 Shell 命令 |
| 刷新状态 | 重新获取服务器最新状态 |
| 容器列表 | 查看 Docker 容器列表 |
| 端口信息 | 查看端口占用情况 |
| 编辑 | 修改服务器配置 |
| 删除 | 删除服务器 |

#### 5. 执行远程命令

1. 点击 **"更多"** → **"执行命令"**
2. 在弹窗中输入要执行的命令
3. 点击 **"执行"** 按钮
4. 查看命令执行结果

**示例命令：**
```bash
# 查看系统信息
uname -a

# 查看磁盘使用
df -h

# 查看 Docker 容器
docker ps -a
```

---

## SSH 密钥管理

SSH 密钥用于免密码登录服务器，更安全便捷。

### 密钥列表
- 显示已上传的所有 SSH 密钥
- 每个密钥显示：名称、文件名、指纹、关联服务器数量

### 添加密钥方式

#### 方式一：上传文件
1. 准备好 `.pem` 或 `.key` 格式的私钥文件
2. 点击"选择 .pem 文件"按钮
3. 选择文件上传
4. 系统自动读取内容并生成指纹

#### 方式二：粘贴内容
1. 打开私钥文件，复制全部内容
2. 粘贴到"或输入内容"文本框
3. 系统验证格式并保存

### 使用密钥连接服务器
后端会自动使用密钥进行 SSH 连接：
```bash
ssh -i /path/to/key.pem user@host
```

---

## Kubernetes 集群管理

### 访问路径
`Kubernetes` → `集群管理`（路径：`/kubernetes/clusters`）

### 功能说明

#### 1. 集群列表
- 显示所有已添加的 K8s 集群
- 展示集群状态、节点数量、版本信息

#### 2. 添加集群
| 字段 | 说明 |
|------|------|
| 集群名称 | 集群显示名称 |
| API Server | Kubernetes API 地址 |
| Token | 访问 Token |
| kubeconfig | 可选，上传 kubeconfig 文件 |

#### 3. 集群操作
- **查看部署**：查看集群中的 Deployment
- **扩缩容**：手动调整 Pod 副本数
- **HPA 配置**：配置水平自动伸缩
- **AI 分析**：AI 分析集群状态并提供建议

---

## 告警中心

### 访问路径
`告警中心`（路径：`/alerts`）

### 功能概览

#### 1. 告警统计卡片
| 卡片 | 说明 |
|------|------|
| 告警总数 | 所有告警数量 |
| 待处理 | 等待处理的告警 |
| 已处理 | 已解决的告警 |
| 平均处理时间 | 告警处理平均耗时 |

#### 2. 告警列表
显示所有告警，支持按级别和状态筛选：

**告警级别：**
- 🔴 **紧急 (critical)**：需要立即处理
- 🟠 **警告 (warning)**：需要关注
- 🔵 **信息 (info)**：一般通知

**告警状态：**
- ⏳ **pending**：待处理
- 🔄 **processing**：处理中
- ✅ **resolved**：已解决

#### 3. 处理告警
1. 点击告警行的 **"详情"** 按钮
2. 查看告警详细信息
3. 填写处理备注
4. 点击 **"标记已解决"** 或 **"处理"** 按钮

#### 4. 检测规则配置
右侧面板可配置告警规则：

| 字段 | 说明 |
|------|------|
| 规则名称 | 规则描述名称 |
| 监控指标 | CPU/内存/磁盘/网络 |
| 条件 | 阈值条件（> / < / =） |
| 阈值 | 触发告警的阈值百分比 |
| 告警级别 | 紧急/警告/信息 |
| 持续时间 | 持续多长时间触发 |

**示例规则：**
- CPU 使用率 > 80%，持续 5 分钟 → 发送警告
- 内存使用率 > 90%，持续 3 分钟 → 发送紧急告警

#### 5. AI 决策建议
系统会根据告警自动生成 AI 决策建议：
- 显示置信度百分比
- 提供"采纳"或"忽略"操作
- 采纳后可自动执行修复操作

---

## 系统管理

### 用户管理

**访问路径：** `系统管理` → `用户管理`

#### 用户列表
显示所有系统用户，支持按用户名和状态搜索。

#### 添加用户
| 字段 | 必填 | 说明 |
|------|------|------|
| 用户名 | ✅ | 登录用户名（唯一） |
| 密码 | ✅ | 登录密码 |
| 昵称 | ❌ | 显示名称 |
| 邮箱 | ❌ | 用户邮箱 |
| 手机号 | ❌ | 用户手机号 |
| 角色 | ✅ | 分配的角色 |
| 状态 | ❌ | 启用/禁用 |

#### 编辑用户
- 修改用户信息
- 更换角色
- 启用/禁用账户

#### 删除用户
- 点击删除按钮
- 确认后删除用户

> ⚠️ 注意：删除操作不可恢复

### 角色管理

**访问路径：** `系统管理` → `角色管理`

#### 预设角色
| 角色 | 关键字 | 权限说明 |
|------|--------|----------|
| 超级管理员 | admin | 拥有所有权限 |
| 运维人员 | operator | 服务器管理、命令执行、AI分析 |
| 普通用户 | user | 只读权限 |

#### 添加角色
| 字段 | 必填 | 说明 |
|------|------|------|
| 角色名称 | ✅ | 角色显示名称 |
| 角色关键字 | ✅ | 角色唯一标识 |
| 描述 | ❌ | 角色描述 |
| 菜单权限 | ✅ | 勾选可访问的菜单 |
| 状态 | ❌ | 启用/禁用 |

#### 配置菜单权限
1. 在角色编辑弹窗中
2. 勾选菜单树中的菜单项
3. 保存后生效

### 菜单管理

**访问路径：** `系统管理` → `菜单管理`

#### 菜单树结构
系统菜单采用树形结构，支持多级嵌套。

#### 添加菜单
| 字段 | 说明 |
|------|------|
| 上级菜单 | 父级菜单，顶级菜单选择"根目录" |
| 菜单名称 | 显示名称 |
| 路由名称 | Vue Router 名称 |
| 路由路径 | URL 路径 |
| 组件路径 | Vue 组件路径 |
| 图标 | 菜单图标 |
| 排序 | 显示顺序 |
| 状态 | 显示/隐藏 |

#### 编辑/删除菜单
- 点击操作按钮进行编辑或删除
- 删除菜单会同时删除子菜单

---

## 租户管理

### 访问路径
`租户管理`（路径：`/tenant`）

### 功能模块

#### 1. 租户列表
- 显示所有租户
- 展示套餐、状态、用户数等信息
- 支持搜索和筛选

#### 2. 套餐管理
预设套餐：
| 套餐 | 用户数 | 资源数 | 存储 | 价格 |
|------|--------|--------|------|------|
| 免费版 | 3 | 10 | 5GB | 免费 |
| 入门版 | 10 | 50 | 20GB | ¥99/月 |
| 专业版 | 50 | 200 | 100GB | ¥299/月 |
| 企业版 | 不限 | 不限 | 1TB | 定制 |

#### 3. 账单管理
- 查看租户账单记录
- 支持导出账单

#### 4. 审计日志
- 记录所有操作日志
- 支持按时间、用户、操作类型筛选

---

## 其他功能模块

### 1. 灰度发布
**路径：** `/canary`

功能：
- 创建灰度发布任务
- 配置流量比例
- 监控发布状态
- 支持一键回滚

### 2. 负载均衡
**路径：** `/loadbalancer`

功能：
- 管理负载均衡器
- 配置后端服务器
- 健康检查配置
- 流量分发策略

### 3. 证书管理
**路径：** `/certificate`

功能：
- SSL 证书管理
- 证书到期提醒
- 自动续签配置
- 证书部署

### 4. CDN 管理
**路径：** `/cdn`

功能：
- CDN 域名管理
- 缓存规则配置
- 刷新预热
- 流量统计

### 5. 智能部署
**路径：** `/deploy`

功能：
- 项目上传分析
- 自动生成部署方案
- 服务器选择推荐
- 一键部署

### 6. 任务调度
**路径：** `/scheduler`

功能：
- 定时任务管理
- 任务执行历史
- 任务模板
- 批量任务

### 7. Agent 管理
**路径：** `/agents`

功能：
- Agent 列表管理
- 版本管理
- 灰度升级
- 心跳监控

### 8. 高可用
**路径：** `/ha`

功能：
- 集群节点管理
- Leader 选举
- 分布式锁
- 故障转移

### 9. 灾备备份
**路径：** `/backup`

功能：
- 备份任务管理
- 恢复操作
- 备份验证
- 演练记录

### 10. 成本控制
**路径：** `/cost`

功能：
- 资源成本统计
- 闲置资源发现
- 成本预测
- 优化建议

---

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + K` | 打开全局搜索 |
| `Esc` | 关闭弹窗 |

---

## 常见操作流程

### 流程一：添加新服务器并监控

```
1. 准备 SSH 密钥（如需要）
   └→ 上传 .pem 文件

2. 添加服务器
   └→ 填写服务器信息
   └→ 选择认证方式
   └→ 保存

3. 配置告警规则
   └→ 进入告警中心
   └→ 添加检测规则
   └→ 设置阈值和通知

4. 定期查看监控
   └→ 服务器列表 → 监控
   └→ 或使用 AI 分析
```

### 流程二：处理告警

```
1. 收到告警通知
   └→ 进入告警中心

2. 查看告警详情
   └→ 分析问题原因

3. 查看AI建议（如有）
   └→ 采纳或忽略

4. 处理问题
   └→ 执行修复命令
   └→ 或手动干预

5. 标记已解决
   └→ 填写处理备注
   └→ 关闭告警
```

### 流程三：新建用户并分配权限

```
1. 创建角色（如需要）
   └→ 系统管理 → 角色管理
   └→ 新增角色
   └→ 配置菜单权限

2. 创建用户
   └→ 系统管理 → 用户管理
   └→ 新增用户
   └→ 选择角色
   └→ 保存

3. 通知用户
   └→ 告知用户名和密码
   └→ 提示修改密码
```

---

## 附录

### 状态说明

| 状态 | 颜色 | 说明 |
|------|------|------|
| 在线 | 🟢 绿色 | 服务正常 |
| 离线 | 🔴 红色 | 服务不可用 |
| 未知 | ⚪ 灰色 | 状态未知 |
| 启用 | 🟢 绿色 | 功能开启 |
| 禁用 | 🔴 红色 | 功能关闭 |

### 告警级别

| 级别 | 颜色 | 处理时限 |
|------|------|----------|
| 紧急 | 🔴 红色 | 立即处理 |
| 警告 | 🟠 橙色 | 24小时内 |
| 信息 | 🔵 蓝色 | 可忽略 |

### 权限代码说明

| 权限代码 | 说明 |
|----------|------|
| server:view | 查看服务器 |
| server:add | 添加服务器 |
| server:edit | 编辑服务器 |
| server:delete | 删除服务器 |
| server:execute | 执行命令 |
| server:ssh | SSH 连接 |
| server:analyze | AI 分析 |
| user:view | 查看用户 |
| user:add | 添加用户 |
| user:edit | 编辑用户 |
| user:delete | 删除用户 |
| role:view | 查看角色 |
| role:add | 添加角色 |
| role:edit | 编辑角色 |
| role:delete | 删除角色 |

---

## 技术支持

如遇问题，请通过以下方式获取帮助：
- GitHub Issues: https://github.com/fredphp/yunwei/issues
- 查看部署文档: [DEPLOYMENT.md](./DEPLOYMENT.md)
